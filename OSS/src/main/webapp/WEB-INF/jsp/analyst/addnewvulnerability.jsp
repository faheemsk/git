<%-- 
    Document   : addnewvulnerability
    Created on : May 26, 2016, 6:46:33 PM
    Author     : vkosuri
--%>
<%@taglib prefix="c" uri="/WEB-INF/tlds/c.tld" %>
<%@taglib prefix="form" uri="/WEB-INF/tlds/spring-form.tld" %>
<%@taglib uri="http://jakarta.apache.org/taglibs/unstandard-1.0" prefix="un"%>
<un:useConstants className="com.optum.oss.constants.ApplicationConstants" var="constants"/>
<script type="text/javascript" src="<c:url value="/appjs/jquery-ui-1.10.4.js"/>"></script>

<script>
    // this prevents any overhead from creating the object each time
    var element = document.createElement('div');

    function decodeHTMLEntities (str) {
      if(str && typeof str === 'string') {
        // strip script/html tags
        str = str.replace(/<script[^>]*>([\S\s]*?)<\/script>/gmi, '');
        str = str.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gmi, '');
        element.innerHTML = str;
        str = element.textContent;
        element.textContent = '';
      }

      return str;
    }
      
    var fndNames = [];
    //Start: For manual vulnerability name auto complete search
    $(document).ready(function() {
        $("#rootCauseCodeId").prop("disabled", false); 
        var source = '<c:out value="${vulnerabilityDTO.sourceName}" escapeXml="true"/>';
        if (source === '' || source === 'Manual') {
            var allFindingNms = [];
            
    <c:forEach items="${manualVulnerabilities}" var="vulnerabilityDTO">
            fndNames["<c:out value="${vulnerabilityDTO.vulnerabilityName}" escapeXml="true"/>".toUpperCase()] = "<c:out value="${vulnerabilityDTO.rootCauseCode}" escapeXml="true"/>";
            allFindingNms.push({
                key: "<c:out value="${vulnerabilityDTO.rootCauseCode}" escapeXml="true"/>",
                value: decodeHTMLEntities("<c:out value="${vulnerabilityDTO.vulnerabilityName}" escapeXml="true"/>")
            });
    </c:forEach>

            $("#addvulnerabilityName").autocomplete({
                source: allFindingNms,
                select: function (event, ui) {
                    var catCode = ui.item.key;
                    $("#rootCauseCodeId").val(catCode);
                    if(ui.item.key === ""){
                        $("#rootCauseCodeId").prop("disabled", false); 
                        $("#rootCauseCodeHid").prop("disabled", true);
                    }else{
                        $("#rootCauseCodeId").prop("disabled", true); 
                        $("#rootCauseCodeHid").val(catCode);
                        $("#rootCauseCodeHid").prop("disabled", false);
                    }
                    
                }
            });
        }
        
        showOWASPforAVA();
        //To disable vulnerability category in Edit Finding
        <c:if test="${!empty vulnerabilityDTO.rootCauseCode}">
            $("#rootCauseCodeId").prop("disabled", true);
            $("#rootCauseCodeHid").val('<c:out value="${vulnerabilityDTO.rootCauseCode}" escapeXml="true"/>');
            $("#rootCauseCodeHid").prop("disabled", false);
        </c:if>
    });
    //End: For manual vulnerability name auto complete search
    
    function changeNm(fName){
        var categoryCd = fndNames[fName.toUpperCase().trim()];
        if(typeof categoryCd !== 'undefined'){
            $("#rootCauseCodeId").val(fndNames[fName.toUpperCase().trim()]);
            $("#rootCauseCodeId").prop("disabled", true); 
            $("#rootCauseCodeHid").val(categoryCd);
            $("#rootCauseCodeHid").prop("disabled", false);
        }else{
            $("#rootCauseCodeId").val("");
            $("#rootCauseCodeId").prop("disabled", false); 
            $("#rootCauseCodeHid").val("");
            $("#rootCauseCodeHid").prop("disabled", true);
        }
        if(categoryCd === ""){
            $("#rootCauseCodeId").prop("disabled", false); 
            $("#rootCauseCodeHid").prop("disabled", true);
        }
    }
        
    function showOWASPforAVA() {
        var m = $("#securityServiceID").val();
        //alert(m);
        if ($("#securityServiceID").val() === 'AV') {
          //      alert("AV SELECTED..");
                $("#showOWASPId").show();
            } else {
                $("#showOWASPId").hide();
            }
    }
    
</script>
<h1 class="ux-float-left ux-width-full-4t ux-margin-top-1t">
    <c:if test="${pageName eq 'UPDATEPAGE'}">Update Finding</c:if>
    <c:if test="${pageName eq 'ADDPAGE'}">Add New Finding</c:if>
    </h1>
    <span class="ux-float-right ux-padding-1t">
        <c:if test="${!empty roadmapObj.csaDomainCode}">
            <input type="button" value="Back" title="Back" class="ux-btn ux-btn-default-action" onclick="cancelButtonRoadmap()"/>
        </c:if>
    </span>
    <div class="ux-clear"></div>
    <p class="ux-form-required">
        <strong class="ux-labl-required ">*</strong> Required
    </p>

    <!--Displayed in Add Page-->
<c:if test="${pageName ne 'UPDATEPAGE'}">
    <div class="ux-panl ux-float-left">
        <div class="ux-panl-header ux-panl-with-underline" >
            <h2> Finding Details</h2>
        </div>
        <div class=" ux-panl-content " >
            <div class="ux-hform">

                <dl class="ux-height-4t">
                    <dt>
                    <label>Service: <span>*</span></label>
                    </dt>
                    <dd><select id="securityServiceID" name="securityServiceObj.securityServiceCode" onchange="showOWASPforAVA();">
                            <option value="">Select</option>
                            <c:forEach var="serviceDTO" items="${servicesList}">
                                <!--Added condition for bug fix: IN021203-->
                                <c:if test="${serviceDTO.reviewStatus ne constants.DB_ROW_STATUS_REVIEWED}">
                                    <option value="${serviceDTO.securityServiceCode}" <c:if test="${serviceDTO.securityServiceCode eq vulnerabilityDTO.securityServiceObj.securityServiceCode}">selected</c:if> >${serviceDTO.securityServiceName}</option>
                                </c:if>
                            </c:forEach>
                        </select>  
                        <form:errors path="securityServiceObj.securityServiceCode" cssStyle="color: red;width:190px; font-weight: bold"/>
                    </dd>
                    <label id="errorMsgsecurityServiceID" class="ux-msg-error-under"></label>
                </dl>
                <dl class="ux-height-4t">
                    <dt>
                    <label>Source:</label>
                    </dt>
                    <dd>Manual</dd>
                </dl>

                <dl class="ux-height-4t">
                    <dt>
                    <label>IP Address:</label>
                    </dt>
                    <dd><input type="text" name="ipAddress" id="ipAddressId" value="${vulnerabilityDTO.ipAddress}"/>
                        <br/><form:errors path="ipAddress" cssStyle="color: red;width:190px; font-weight: bold"/>
                    </dd>
                    <label id="errorMsgIpAddress" class="ux-msg-error-under"></label>
                </dl>
                <dl class="ux-height-4t">
                    <dt>
                    <label>Application Name:</label>
                    </dt>
                    <dd><input type="text" id="softwareNameID" name="softwareName" value="${vulnerabilityDTO.softwareName}"/>
                        <br/><form:errors path="softwareName" cssStyle="color: red;width:190px; font-weight: bold"/>
                    </dd>
                    <label id="errorMsgSoftwareNameID" class="ux-msg-error-under"></label>
                </dl>
                <dl class="ux-height-4t">
                    <dt>
                    <label>Host:</label>
                    </dt>
                    <dd><input type="text" id="hostNameId" name="hostName" value="${vulnerabilityDTO.hostName}"/>
                        <br/><form:errors path="hostName" cssStyle="color: red;width:190px; font-weight: bold"/>
                    </dd>
                    <label id="errorMsgHostNameId" class="ux-msg-error-under"></label>
                </dl>
                <dl class="ux-height-4t">
                    <dt>
                    <label>Domain:</label>
                    </dt>
                    <dd><input type="text" id="domainNameId" name="domainName" value="${vulnerabilityDTO.domainName}"/>
                        <br/><form:errors path="domainName" cssStyle="color: red;width:190px; font-weight: bold"/>
                    </dd>
                    <label id="errorMsgDomainNameId"class="ux-msg-error-under"></label>
                </dl>
                <dl class="ux-height-4t">
                    <dt>
                    <label>URL:</label>
                    </dt>
                    <dd><input type="text" name="appURL" id="appURLID" value="${vulnerabilityDTO.appURL}"/>
                        <br/><form:errors path="appURL" cssStyle="color: red;width:190px; font-weight: bold"/>
                    </dd>
                    <label id="errorMsgAppURLID" class="ux-msg-error-under"></label>
                </dl>

                <dl class="ux-height-4t">
                    <dt>
                    <label>Operating System: </label>
                    </dt>
                    <dd>
                        <select name="operatingSystemCode">
                            <option value="">Select</option>
                            <c:forEach var="operatingSystem" items="${osList}">
                                <option value="${operatingSystem.masterLookupCode}" <c:if test="${operatingSystem.masterLookupCode eq vulnerabilityDTO.operatingSystemCode}">selected</c:if>>${operatingSystem.lookUpEntityName}</option>
                            </c:forEach>
                        </select>
                        <br/><form:errors path="operatingSystem" cssStyle="color: red;width:190px; font-weight: bold"/>
                    </dd>
                </dl>


                <dl class="ux-height-4t">
                    <dt>
                    <label>MAC Address:</label>
                    </dt>
                    <dd><input type="text" name="macAddress" id="macAddressId" value="${vulnerabilityDTO.macAddress}"/>
                        <br/><form:errors path="macAddress" cssStyle="color: red;width:190px; font-weight: bold"/>
                    </dd>
                    <label id="errorMsgMacAddressId" class="ux-msg-error-under"></label>
                </dl>
                <dl class="ux-height-4t">
                    <dt>
                    <label>Port:</label>
                    </dt>
                    <dd><input type="text" name="portNumber" id="portNumberID" 
                               value="<c:if test="${vulnerabilityDTO.portNumber != 'null'}">${vulnerabilityDTO.portNumber}</c:if>"/> 
                        <br/><form:errors path="portNumber" cssStyle="color: red;width:190px; font-weight: bold"/>
                    </dd>
                    <label id="errorMsgPortNumberID" class="ux-msg-error-under"></label>
                </dl>
            </div>
        </div>
    </div>
</c:if>

<!--Displayed in Update Page-->
<c:if test="${pageName eq 'UPDATEPAGE'}">
    <script>
        $(document).ready(function() {
           // alert();
           // alert($("#securityServiceID").val());
            if($("#securityServiceID").val()==='AV'){
                $("#showOWASPId").show();
            }
            $("#updvulinfo").accordion({
                collapsible: true
            });
        });
    </script>
    <div id="updvulinfo" class="ux-margin-top-2t" >
        <!--            <div class="ux-accordion-panl-header ux-panl-with-underline" >
                        <h2><a class="menuitem submenuheader " href="#" ></a></h2>
                    </div>-->
        <h3> Finding Details</h3>
        <c:choose>
            <c:when test="${vulnerabilityDTO.sourceName eq 'Manual'}">
                <div class="ux-accordion-panl">
                    <div class="ux-hform">
                        <input type="hidden" value="<c:out value="${vulnerabilityDTO.sourceName}" escapeXml="true"/>"
                               id="sourceName" name="sourceName"/>
                        <dl class="ux-height-4t">
                            <dt>
                            <label>Service: <span>*</span></label>
                            </dt>
                            <dd><select id="securityServiceID" name="securityServiceObj.securityServiceCode" onchange="showOWASPforAVA();">
                                    <option value="">Select</option>
                                    <c:forEach var="serviceDTO" items="${servicesList}">
                                        <!--Added condition for bug fix: IN021203-->
                                        <c:if test="${serviceDTO.reviewStatus ne constants.DB_ROW_STATUS_REVIEWED}">
                                            <option value="${serviceDTO.securityServiceCode}" <c:if test="${serviceDTO.securityServiceCode eq vulnerabilityDTO.securityServiceObj.securityServiceCode}">selected</c:if> >${serviceDTO.securityServiceName}</option>
                                        </c:if>
                                    </c:forEach>
                                </select>  
                                <form:errors path="securityServiceObj.securityServiceCode" cssStyle="color: red;width:190px; font-weight: bold"/>
                            </dd>
                            <label id="errorMsgsecurityServiceID" class="ux-msg-error-under"></label>
                        </dl>
                        <dl class="ux-height-4t">
                            <dt>
                            <label>Source:</label>
                            </dt>
                            <dd>Manual</dd>
                        </dl>

                        <dl class="ux-height-4t">
                            <dt>
                            <label>IP Address:</label>
                            </dt>
                            <dd><input type="text" name="ipAddress" id="ipAddressId" value="${vulnerabilityDTO.ipAddress}"/>
                                <br/><form:errors path="ipAddress" cssStyle="color: red;width:190px; font-weight: bold"/>
                            </dd>
                            <label id="errorMsgIpAddress" class="ux-msg-error-under"></label>
                        </dl>
                        <dl class="ux-height-4t">
                            <dt>
                            <label>Application Name:</label>
                            </dt>
                            <dd><input type="text" id="softwareNameID" name="softwareName" value="${vulnerabilityDTO.softwareName}"/>
                                <br/><form:errors path="softwareName" cssStyle="color: red;width:190px; font-weight: bold"/>
                            </dd>
                            <label id="errorMsgSoftwareNameID" class="ux-msg-error-under"></label>
                        </dl>
                        <dl class="ux-height-4t">
                            <dt>
                            <label>Host:</label>
                            </dt>
                            <dd><input type="text" id="hostNameId" name="hostName" value="${vulnerabilityDTO.hostName}"/>
                                <br/><form:errors path="hostName" cssStyle="color: red;width:190px; font-weight: bold"/>
                            </dd>
                            <label id="errorMsgHostNameId" class="ux-msg-error-under"></label>
                        </dl>
                        <dl class="ux-height-4t">
                            <dt>
                            <label>Domain:</label>
                            </dt>
                            <dd><input type="text" id="domainNameId" name="domainName" value="${vulnerabilityDTO.domainName}"/>
                                <br/><form:errors path="domainName" cssStyle="color: red;width:190px; font-weight: bold"/>
                            </dd>
                            <label id="errorMsgDomainNameId"class="ux-msg-error-under"></label>
                        </dl>
                        <dl class="ux-height-4t">
                            <dt>
                            <label>URL:</label>
                            </dt>
                            <dd><input type="text" name="appURL" id="appURLID" value="${vulnerabilityDTO.appURL}"/>
                                <br/><form:errors path="appURL" cssStyle="color: red;width:190px; font-weight: bold"/>
                            </dd>
                            <label id="errorMsgAppURLID" class="ux-msg-error-under"></label>
                        </dl>

                        <dl class="ux-height-4t">
                            <dt>
                            <label>Operating System: </label>
                            </dt>
                            <dd>
                                <select name="operatingSystemCode">
                                    <option value="">Select</option>
                                    <c:forEach var="operatingSystem" items="${osList}">
                                        <option value="${operatingSystem.masterLookupCode}" <c:if test="${operatingSystem.masterLookupCode eq vulnerabilityDTO.operatingSystemCode}">selected</c:if>>${operatingSystem.lookUpEntityName}</option>
                                    </c:forEach>
                                </select>
                                <br/><form:errors path="operatingSystem" cssStyle="color: red;width:190px; font-weight: bold"/>
                            </dd>
                        </dl>


                        <dl class="ux-height-4t">
                            <dt>
                            <label>MAC Address:</label>
                            </dt>
                            <dd><input type="text" name="macAddress" id="macAddressId" value="${vulnerabilityDTO.macAddress}"/>
                                <br/><form:errors path="macAddress" cssStyle="color: red;width:190px; font-weight: bold"/>
                            </dd>
                            <label id="errorMsgMacAddressId" class="ux-msg-error-under"></label>
                        </dl>
                        <dl class="ux-height-4t">
                            <dt>
                            <label>Port:</label>
                            </dt>
                            <dd><input type="text" name="portNumber" id="portNumberID" 
                                       value="<c:if test="${vulnerabilityDTO.portNumber != 'null'}">${vulnerabilityDTO.portNumber}</c:if>"/> 
                                <br/><form:errors path="portNumber" cssStyle="color: red;width:190px; font-weight: bold"/>
                            </dd>
                            <label id="errorMsgPortNumberID" class="ux-msg-error-under"></label>
                        </dl>
                    </div>
                </div>
            </c:when>
            <c:otherwise>
                <div class="ux-accordion-panl">
                    <div class="ux-hform">
                        <dl>
                            <dt>
                            <label>Service:</label>
                            </dt>
                            <dd><input type="hidden" id="securityServiceID" value="${vulnerabilityDTO.securityServiceObj.securityServiceCode}"/> 
                                <c:out value="${vulnerabilityDTO.clientEngagementDTO.securityServiceName}" escapeXml="true"></c:out></dd>
                        </dl>
                        <dl>
                            <dt>
                            <label>Source:</label>
                            </dt>
                            <dd><c:out value="${vulnerabilityDTO.sourceName}" escapeXml="true"></c:out></dd>
                        </dl>
                        <div class="ux-clear"></div>
                        <dl>
                            <dt>
                            <label>Finding Instance:</label>
                            </dt>
                            <dd><c:out value="${vulnerabilityDTO.instanceIdentifier}" escapeXml="true"></c:out></dd>
                        </dl>

                        <dl>
                            <dt>
                            <label>IP Address:</label>
                            </dt>
                            <dd><c:out value="${vulnerabilityDTO.ipAddress}" escapeXml="true"></c:out></dd>
                        </dl>
                        
                        <dl>
                            <dt>
                            <label>Host:</label>
                            </dt>
                            <dd style="word-wrap: break-word;"><c:out value="${vulnerabilityDTO.hostName}" escapeXml="true"></c:out></dd>
                        </dl>
                        <dl>
                            <dt>
                            <label>Domain:</label>
                            </dt>
                            <dd style="word-wrap: break-word;"><c:out value="${vulnerabilityDTO.domainName}" escapeXml="true"></c:out></dd>
                        </dl>
                        <dl>
                            <dt>
                            <label>Port:</label>
                            </dt>
                            <dd><c:out value="${vulnerabilityDTO.portNumber}" escapeXml="true"></c:out></dd>
                        </dl>
                        
                        <div class="ux-clear"></div>
                        <dl>
                            <dt>
                            <label>MAC Address:</label>
                            </dt>
                            <dd style="word-wrap: break-word;"><c:out value="${vulnerabilityDTO.macAddress}" escapeXml="true"></c:out></dd>
                        </dl>
                        <dl>
                            <dt>
                            <label>Netbios:</label>
                            </dt>
                            <dd><c:out value="${vulnerabilityDTO.netbiosName}" escapeXml="true"></c:out></dd>
                        </dl>
                        <dl>
                            <dt>
                            <label>Operating System:
                            </label>
                            </dt>
                            <dd><c:out value="${vulnerabilityDTO.operatingSystem}" escapeXml="true"></c:out></dd>
                        </dl>
                        <dl>
                            <dt>
                            <label>Application Name:</label>
                            </dt>
                            <dd style="word-wrap: break-word;"><c:out value="${vulnerabilityDTO.softwareName}" escapeXml="true"></c:out></dd>
                        </dl>
                        <dl>
                            <dt>
                            <label>URL:</label>
                            </dt>
                            <dd style="word-wrap: break-word;"><c:out value="${vulnerabilityDTO.appURL}" escapeXml="true"></c:out></dd>
                        </dl>
                        <div class="ux-clear"></div>
                        
                        <dl>
                            <dt>
                            <label>Scan Tool</label>
                            </dt>
                            <dd><c:out value="${vulnerabilityDTO.scanTool}"escapeXml="true"></c:out></dd>
                        </dl>
                        <dl>
                            <dt>
                            <label>Scan Start Date:</label>
                            </dt>
                            <dd><c:out value="${vulnerabilityDTO.scanStartDate}" escapeXml="true"></c:out></dd>
                        </dl>
                        <dl>
                            <dt>
                            <label>Scan End Date:</label>
                            </dt>
                            <dd><c:out value="${vulnerabilityDTO.scanEndDate}" escapeXml="true"></c:out></dd>
                        </dl>
                        <dl>
                            <dt>
                            <label>Scan Identifier:</label>
                            </dt>
                            <dd><c:out value="${vulnerabilityDTO.scanIdentifier}" escapeXml="true"></c:out></dd>
                        </dl>
                            
                            
                            
                        <div class="ux-clear"></div>
                        <dl>
                            <dt>
                            <label>Scan Severity Level</label>
                            </dt>
                            <dd>${vulnerabilityDTO.srcSeverityLevel}</dd>
                        </dl>
                        <dl>
                            <dt>
                            <label>Scan Base Score</label>
                            </dt>
                            <dd>${vulnerabilityDTO.cveInformationDTO.srcBaseScore}</dd>
                        </dl>
                        <dl>
                            <dt>
                            <label>Scan Temporal Score</label>
                            </dt>
                            <dd>${vulnerabilityDTO.cveInformationDTO.srctemporalScore}</dd>
                        </dl>
                        <dl>
                            <dt>
                            <label>Scan Vector</label>
                            </dt>
                            <dd>${vulnerabilityDTO.vectorText}</dd>
                        </dl>
                    </div>
                </div>
            </c:otherwise>
        </c:choose>
    </div>
</c:if>

<!--Displayed in Both Add & Update Page-->
<c:if test="${pageName eq 'ADDPAGE' || pageName eq 'UPDATEPAGE'}">
    <div class="ux-panl ux-float-left ux-margin-top-1t">
        <div class="ux-panl-header ux-panl-with-underline">
            <h2>Finding Information</h2>
        </div>
        <div class="ux-panl-content">
            <div class="ux-hform">
                <dl class="ux-width-27t">
                    <dt>
                    <label>Finding Name: <span>*</span></label>
                    </dt>
                    <dd>
                        <input name="vulnerabilityName" Class="ux-width-25t" id="addvulnerabilityName" type="text" value="<c:out value="${vulnerabilityDTO.vulnerabilityName}" escapeXml="true"></c:out>" onchange="changeNm(this.value)"
                               <c:if test="${vulnerabilityDTO.sourceName ne 'Manual' && pageName eq 'UPDATEPAGE'}">readonly</c:if>
                               />
                        <form:errors path="vulnerabilityName" cssStyle="color: red;width:250px; display: block; font-weight: bold"/>
                    </dd>
                    <label id="errorMsgVulnerabilityName"  class="ux-msg-error-under"></label>
                </dl>
                
                <c:if test="${pageName eq 'UPDATEPAGE'}">
                    <input type="hidden" value="<c:out value="${vulnerabilityDTO.createdDate}" escapeXml="true"/>" name="createdDate"/>
                    <dl>
                        <dt>
                        <label>Finding Creation Date:</label>
                        </dt>
                        <dd>
                            <c:out value="${vulnerabilityDTO.createdDate}" escapeXml="true"/>
                        </dd>
                    </dl>
                </c:if>
                <div class="ux-clear"></div>
                <dl class="ux-width-35t">
                    <dt>
                    <label>Finding Description: <span class="mandStart">*</span></label>
                    </dt>
                    <dd>
                        <textarea name="description" id="vulnerabilityDescription" class="ux-width-70t" cols="12" rows="4">${vulnerabilityDTO.description}</textarea>
                        <form:errors path="description"   cssStyle="color: red;width:190px; font-weight: bold"/>
                    </dd>
                    <label id="errorMsgVulnerabilityDescription" class="ux-msg-error-under"></label>
                </dl>
                <div class="ux-clear"></div>
                <dl class="ux-width-30t">
                    <dt>
                    <label>Technical Details: </label>
                    </dt>
                    <dd>
                        <textarea name="techDetails" id="technicalDetails"class="ux-width-70t" cols="12" rows="4">${vulnerabilityDTO.techDetails}</textarea>
                        <form:errors path="techDetails" cssStyle="color: red;width:190px; font-weight: bold"/>
                    </dd>
                    <label id="errorMsgTechnicalDetails" class="ux-msg-error-under"></label>
                </dl>
                <div class="ux-clear"></div>
                <dl class="ux-width-30t">
                    <dt>
                    <label>Impact Detail: <span class="mandStart">*</span></label>
                    </dt>
                    <dd>
                        <textarea name="impactDetails" id="impactDetail" class="ux-width-70t" cols="12" rows="4">${vulnerabilityDTO.impactDetails}</textarea>
                        <form:errors path="impactDetails" cssStyle="color: red;width:190px; font-weight: bold"/>
                    </dd>
                    <label id="errorMsgImpactDetail" class="ux-msg-error-under"></label>
                </dl>
                <div class="ux-clear"></div>
                <dl class="ux-width-30t">
                    <dt>
                    <label>Recommendation: <span class="mandStart">*</span></label>
                    </dt>
                    <dd>
                        <textarea name="recommendation" id="recommendationId" class="ux-width-70t" cols="12" rows="4">${vulnerabilityDTO.recommendation}</textarea>
                        <form:errors path="recommendation" cssStyle="color: red;width:190px; font-weight: bold"/>
                    </dd>
                    <label id="errorMsgrecommendationId" class="ux-msg-error-under"></label>
                </dl>
                <div class="ux-clear"></div>
                <dl class="ux-width-27t">
                    <dt>
                    <label>Vulnerability Category: <span class="mandStart">*</span></label>
                    </dt>
                    <dd>
                        <input type="hidden" value="" name="rootCauseCode" id="rootCauseCodeHid" disabled="true"/>
                        <select name="rootCauseCode" id="rootCauseCodeId" onchange="fnrootCauseDetail(this.value);" class="ux-width-25t rootCause" >
                            <option value="">Select</option>
                            <c:forEach var="rootCauseDTO" items="${rootCauseList}">
                                <option value="${rootCauseDTO.masterLookupCode}" title="${rootCauseDTO.lookUpEntityDescription}" <c:if test="${vulnerabilityDTO.rootCauseCode eq rootCauseDTO.masterLookupCode}">selected</c:if> >
                                    ${rootCauseDTO.lookUpEntityName}
                                </option>
                            </c:forEach>
                        </select> 
                    </dd>
                    <label id="errorMsgRootCauseCodeId" class="ux-msg-error-under"></label>
                    <form:errors path="rootCauseCode" cssStyle="color: red;width:190px; font-weight: bold"/>

                    <span id="addRootCauseDetail" class="others ux-float-left ux-margin-top-min">
                        <input type="text" name="rootCauseName" id="rootCauseName" value="${vulnerabilityDTO.rootCauseName}" class="ux-width-24t"/><br/>
                        <form:errors path="rootCauseName" cssStyle="color: red;width:190px; font-weight: bold"/>
                        <label id="errorMsgAddRootCauseDetail" class="ux-msg-error-under"></label>
                    </span>                            
                </dl>
                <dl class="ux-width-30t" style="display: none;" id="showOWASPId">
                    <dt>
                    <label>OWASP Top 10: <span>*</span></label>
                    </dt>
                    <dd><select class="ux-width-25t" id="owaspid"  name="owaspKey">
                            <option value="0">Select</option>
                            <c:forEach var="owaspDTO" items="${owaspList}">
                                <option value="${owaspDTO.owaspId}" <c:if test="${vulnerabilityDTO.owaspKey eq owaspDTO.owaspId }">selected</c:if> title="${owaspDTO.owaspDescription}">${owaspDTO.owaspName}</option>
                            </c:forEach>
                        </select>
                    </dd>
                                                                    <label id="errorMsgsecurityOwaspID" class="ux-msg-error-under"></label>

                </dl>                    


            </div>
        </div>
    </div>
                        
    <div class="ux-panl ux-float-left">
        <div class="ux-panl-header ux-panl-with-underline">
          <h2>Finding Status</h2>
        </div>
        <div class="ux-panl-content">
            <div class="ux-hform">
             	<dl class="ux-width-27t">
                    <dt><label>Status:</label> <span>*</span></dt>
                    <input type="hidden" name="oldSelectedStatusCode" value="${vulnerabilityDTO.oldSelectedStatusCode}"/>
                    <dd><select class="ux-width-25t" name="statusCode" id="statusCodeID">                            
                            <option value="">Select</option>
                            <c:forEach var="statusDTO" items="${statusList}">
                                <option value="${statusDTO.masterLookupCode}" <c:if test="${vulnerabilityDTO.statusCode eq statusDTO.masterLookupCode}">selected</c:if> >${statusDTO.lookUpEntityName}</option>
                            </c:forEach>
                        </select>
                        <br/>
                        <form:errors path="statusCode" cssStyle="color: red;width:190px; font-weight: bold"/>
                    </dd>
                    <label id="errorMsgStatusID" class="ux-msg-error-under"></label>
                </dl>
                   
                        <dl <c:choose><c:when test="${vulnerabilityDTO.statusCode eq 'C' || vulnerabilityDTO.statusCode eq 'CE'}"></c:when><c:otherwise>style="display: none"</c:otherwise></c:choose> id="closureDateID">
                    <dt><label>Closure Date:</label></dt>
                    <dd>
                        <c:choose>
                            <c:when test="${empty vulnerabilityDTO.oldClosedDate}">
                                <span id="closedateid">${vulnerabilityDTO.closedDate}</span>
                                <input type="hidden" value="${vulnerabilityDTO.closedDate}" name="closedDate" id="closeddateHid">
                            </c:when>
                            <c:otherwise>
                                ${vulnerabilityDTO.oldClosedDate}
                                <input type="hidden" value="${vulnerabilityDTO.oldClosedDate}" name="closedDate">
                            </c:otherwise>
                        </c:choose>
                    </dd>
                </dl>
                <dl >
                    <dt><label>Validation Date:</label></dt>
                    <dd>
                        <c:choose>
                            <c:when test="${empty vulnerabilityDTO.oldValidatedDate}">
                                <span id="validatedateid">${vulnerabilityDTO.validatedDate}</span>
                                <input type="hidden" value="${vulnerabilityDTO.validatedDate}" name="validatedDate" id="validatedHid"/>
                            </c:when>
                            <c:otherwise>
                                <span id="vid"> ${vulnerabilityDTO.oldValidatedDate}</span>
                                <input type="hidden" value="${vulnerabilityDTO.oldValidatedDate}" name="validatedDate" id="vidTBox"/>
                            </c:otherwise>
                        </c:choose>	
                    </dd>
                </dl>
                <div class="ux-clear"></div>

                <dl class="LongTxt"  <c:choose><c:when test="${vulnerabilityDTO.statusCode eq 'C' || vulnerabilityDTO.statusCode eq 'CE'}"></c:when><c:otherwise>style="display: none"</c:otherwise></c:choose>  id="closureTextID" >
                    <dt><label>Reason for Closure: </label><span>*</span></dt>
                    <dd> <textarea class="ux-width-50t ux-height-5t" name="closedComments" id="closedCommentsId">${vulnerabilityDTO.closedComments}</textarea> </dd>
                    <label id="errorclosedCommentsId" class="ux-msg-error-under"></label>
                </dl>
            </div>
            <div class="ux-clear"></div>
          		
        </div>
      </div>
</c:if>
</div>




